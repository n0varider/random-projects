This code kind of works. I wasn't able to make it work before my deadline, but I'd like to revisit this in the future and make it far more optimized and actually functional.
